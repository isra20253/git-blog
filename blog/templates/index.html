{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %} <!-- 1. AJOUT DE CETTE LIGNE -->

{% block title %}Page d'accueil {% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        
        <!-- COLONNE GAUCHE (Formulaire) : Largeur 4 -->
        <div class="col-md-4">
            <div class="card shadow sticky-top" style="top: 20px;">
                <div class="card-body">
                    <h4>Nouveau Post</h4>
                    <hr>
                    
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        {{ form|crispy }}
                        <!-- Upload d'images : autorise plusieurs fichiers -->
                        <div class="mt-2">
                            <label for="id_images" class="form-label">Images (optionnel)</label>
                            <input type="file" name="images" id="id_images" multiple class="form-control">
                        </div>
                        <input class="btn btn-primary w-100 mt-3" type="submit" value="Publier">
                    </form>
                    
                </div>
            </div>
        </div>

        <!-- COLONNE DROITE (Liste des articles) : Largeur 8 -->
        <div class="col-md-8">
            
            <!-- Boucle pour afficher les articles depuis la base de données -->
            {% for post in posts %}
            <div class="card shadow mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <!-- 2. LOGIQUE POUR L'IMAGE PAR DÉFAUT -->
                            {% if post.author.profile and post.author.profile.image %}
                                <!-- S'il y a une image de profil, on l'affiche -->
                                <img src="{{ post.author.profile.image.url }}" class="img-thumbnail rounded" alt="Photo de {{ post.author.username }}">
                            {% else %}
                                <!-- Sinon, on affiche l'image par défaut -->
                                <img src="{% static 'images/default-profile.png' %}" class="img-thumbnail rounded" alt="Image par défaut">
                            {% endif %}
                        </div>
                        <div class="col-md-8">
                            <!-- Date dynamique -->
                            <small class="text-muted">{{ post.date_created|date:"d F Y" }}</small>
                            <hr>
                            
                            <!-- Titre dynamique -->
                            <h3 class="mt-2"> <a href="{% url 'blog-post_detail' post.id %}">{{ post.title }}</a></h3>
                            
                            <!-- Contenu dynamique (coupé après 20 mots) -->
                            <p class="text-justify">
                                {{ post.content|truncatewords:20 }}
                            </p>
                            
                           
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <!-- Message s'il n'y a aucun article -->
            <div class="alert alert-info">
                Aucun article publié pour le moment. Soyez le premier !
            </div>
            {% endfor %}

        </div>
        
    </div>
</div>
{% endblock %}